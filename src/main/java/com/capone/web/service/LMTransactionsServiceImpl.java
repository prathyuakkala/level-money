package com.capone.web.service;

import java.io.IOException;
import java.util.Collection;
import java.util.List;

import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Service;

import com.capone.web.helper.HttpHelper;
import com.capone.web.model.LMTransaction;
import com.capone.web.model.LMTransactionList;
import com.fasterxml.jackson.core.JsonParseException;
import com.fasterxml.jackson.core.type.TypeReference;
import com.fasterxml.jackson.databind.JsonMappingException;
import com.fasterxml.jackson.databind.ObjectMapper;
import com.fasterxml.jackson.databind.type.TypeFactory;

@Service
public class LMTransactionsServiceImpl implements LMTransactionsService {

	@Autowired
	private HttpHelper httpHelper;

	public LMTransactionList getAllTransactions() throws JsonParseException, JsonMappingException, IOException {

		ObjectMapper mapper = new ObjectMapper();
		String jsonAsString = httpHelper
				.httpClientPost("https://2016.api.levelmoney.com/api/v2/core/get-all-transactions", "");

		// List<LMTransaction> transaction = mapper.readValue(jsonInString,
		// List.class);
		return mapper.readValue(jsonAsString,LMTransactionList.class);
				//TypeFactory.defaultInstance().constructCollectionType(List.class, LMTransactionList.class));
	}

}
//{"error":"no-error","transactions":[{"amount":-34300,"is-pending":false,"aggregation-time":1412686740000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1412790480000,"transaction-id":"1412790480000","raw-merchant":"7-ELEVEN 23853","categorization":"Unknown","merchant":"7-Eleven 23853","transaction-time":"2014-10-07T12:59:00.000Z"},{"amount":-30200,"is-pending":false,"aggregation-time":1412702940000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1412985120000,"transaction-id":"1412985120000","raw-merchant":"SUNOCO 0299792200","categorization":"Unknown","merchant":"Sunoco","transaction-time":"2014-10-07T17:29:00.000Z"},{"amount":-99000,"is-pending":false,"aggregation-time":1412733360000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1412845980000,"transaction-id":"1412845980000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-08T01:56:00.000Z"},{"amount":-188800,"is-pending":false,"aggregation-time":1412760240000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1412942220000,"transaction-id":"1412942220000","raw-merchant":"GIANT EAG 1201","categorization":"Unknown","merchant":"Giant Eag 1201","transaction-time":"2014-10-08T09:24:00.000Z"},{"amount":-860800,"is-pending":false,"aggregation-time":1412764860000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1412948520000,"transaction-id":"1412948520000","raw-merchant":"AT&T BILL PAYMENT","categorization":"Unknown","merchant":"At&T Bill Payment","transaction-time":"2014-10-08T10:41:00.000Z"},{"amount":17081500,"is-pending":false,"aggregation-time":1412859120000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1412909700000,"transaction-id":"1412909700000","raw-merchant":"ZENPAYROLL","categorization":"Unknown","merchant":"Zenpayroll","transaction-time":"2014-10-09T12:52:00.000Z"},{"amount":-103900,"is-pending":false,"aggregation-time":1412924220000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413107820000,"transaction-id":"1413107820000","raw-merchant":"7-ELEVEN 23853","categorization":"Unknown","merchant":"7-Eleven 23853","transaction-time":"2014-10-10T06:57:00.000Z"},{"amount":-2974000,"is-pending":false,"aggregation-time":1412957580000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413018300000,"transaction-id":"1413018300000","raw-merchant":"LOWE'S #2246","categorization":"Unknown","merchant":"Lowe's #2246","transaction-time":"2014-10-10T16:13:00.000Z"},{"amount":-92700,"is-pending":false,"aggregation-time":1412959320000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413042060000,"transaction-id":"1413042060000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-10T16:42:00.000Z"},{"amount":-59400,"is-pending":false,"aggregation-time":1413045780000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413091500000,"transaction-id":"1413091500000","raw-merchant":"H&M","categorization":"Unknown","merchant":"H&M","transaction-time":"2014-10-11T16:43:00.000Z"},{"amount":-371500,"is-pending":false,"aggregation-time":1413105000000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413263400000,"transaction-id":"1413263400000","raw-merchant":"POS PURCHASE POS18758524 0363597 WHOLE FOODS","categorization":"Unknown","merchant":"Whole Foods","transaction-time":"2014-10-12T09:10:00.000Z"},{"amount":-60400,"is-pending":false,"aggregation-time":1413365040000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413630360000,"transaction-id":"1413630360000","raw-merchant":"7-ELEVEN 23853","categorization":"Unknown","merchant":"7-Eleven 23853","transaction-time":"2014-10-15T09:24:00.000Z"},{"amount":-40100,"is-pending":false,"aggregation-time":1413393960000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413830460000,"transaction-id":"1413830460000","raw-merchant":"QDOBA","categorization":"Unknown","merchant":"Qdoba","transaction-time":"2014-10-15T17:26:00.000Z"},{"amount":-432400,"is-pending":false,"aggregation-time":1413451440000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413618600000,"transaction-id":"1413618600000","raw-merchant":"GIANT EAG 1201","categorization":"Unknown","merchant":"Giant Eag 1201","transaction-time":"2014-10-16T09:24:00.000Z"},{"amount":-50000,"is-pending":false,"aggregation-time":1413463920000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413623340000,"transaction-id":"1413623340000","raw-merchant":"JAMBA JUICE #689","categorization":"Unknown","merchant":"Jamba Juice #689","transaction-time":"2014-10-16T12:52:00.000Z"},{"amount":-192900,"is-pending":false,"aggregation-time":1413485880000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413509340000,"transaction-id":"1413509340000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-16T18:58:00.000Z"},{"amount":-56500,"is-pending":false,"aggregation-time":1413773700000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413910260000,"transaction-id":"1413910260000","raw-merchant":"JAMBA JUICE #689","categorization":"Unknown","merchant":"Jamba Juice #689","transaction-time":"2014-10-20T02:55:00.000Z"},{"amount":-148600,"is-pending":false,"aggregation-time":1413805260000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414049580000,"transaction-id":"1414049580000","raw-merchant":"REDROBIN","categorization":"Unknown","merchant":"Redrobin","transaction-time":"2014-10-20T11:41:00.000Z"},{"amount":-820000,"is-pending":false,"aggregation-time":1413809580000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1413899100000,"transaction-id":"1413899100000","raw-merchant":"ATM WITHDRAWAL","categorization":"Unknown","merchant":"ATM Withdrawal","transaction-time":"2014-10-20T12:53:00.000Z"},{"amount":-52200,"is-pending":false,"aggregation-time":1413847320000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414153020000,"transaction-id":"1414153020000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-20T23:22:00.000Z"},{"amount":-156600,"is-pending":false,"aggregation-time":1413929460000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1413978480000,"transaction-id":"1413978480000","raw-merchant":"KOHL'S #0323","categorization":"Unknown","merchant":"Kohl's #0323","transaction-time":"2014-10-21T22:11:00.000Z"},{"amount":-50900,"is-pending":false,"aggregation-time":1414045800000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1414114020000,"transaction-id":"1414114020000","raw-merchant":"SERVICE FEE","categorization":"Unknown","merchant":"Service Fee","transaction-time":"2014-10-23T06:30:00.000Z"},{"amount":-111500,"is-pending":false,"aggregation-time":1414083240000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414158720000,"transaction-id":"1414158720000","raw-merchant":"Amazon.com AMZN.COM/BILLWA","categorization":"Unknown","merchant":"Amazon.com Amzn.com/Billwa","transaction-time":"2014-10-23T16:54:00.000Z"},{"amount":-136700,"is-pending":false,"aggregation-time":1414131540000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414266720000,"transaction-id":"1414266720000","raw-merchant":"7-ELEVEN 23853","categorization":"Unknown","merchant":"7-Eleven 23853","transaction-time":"2014-10-24T06:19:00.000Z"},{"amount":-2050400,"is-pending":false,"aggregation-time":1414135200000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414163760000,"transaction-id":"1414163760000","raw-merchant":"NORDSTROM RACK #0474","categorization":"Unknown","merchant":"Nordstrom Rack #0474","transaction-time":"2014-10-24T07:20:00.000Z"},{"amount":-63300,"is-pending":false,"aggregation-time":1414140900000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414239900000,"transaction-id":"1414239900000","raw-merchant":"WWW.ITUNES.COM/BILL","categorization":"Unknown","merchant":"WWW.iTunes.com/Bill","transaction-time":"2014-10-24T08:55:00.000Z"},{"amount":-289300,"is-pending":false,"aggregation-time":1414178820000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414598880000,"transaction-id":"1414598880000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-24T19:27:00.000Z"},{"amount":-2418700,"is-pending":false,"aggregation-time":1414184100000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1414318380000,"transaction-id":"1414318380000","raw-merchant":"SWEENEYS CHEVROLET","categorization":"Unknown","merchant":"Sweeneys Chevrolet","transaction-time":"2014-10-24T20:55:00.000Z"},{"amount":17216400,"is-pending":false,"aggregation-time":1414188060000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1414304220000,"transaction-id":"1414304220000","raw-merchant":"ZENPAYROLL","categorization":"Unknown","merchant":"Zenpayroll","transaction-time":"2014-10-24T22:01:00.000Z"},{"amount":-116700,"is-pending":false,"aggregation-time":1414192080000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414355160000,"transaction-id":"1414355160000","raw-merchant":"Krispy Kreme Donuts","categorization":"Unknown","merchant":"Krispy Kreme Donuts","transaction-time":"2014-10-24T23:08:00.000Z"},{"amount":-800000,"is-pending":false,"aggregation-time":1414205700000,"account-id":"nonce:comfy-checking/hdhehe","clear-date":1414410360000,"transaction-id":"1414410360000","raw-merchant":"ATM WITHDRAWAL","categorization":"Unknown","merchant":"ATM Withdrawal","transaction-time":"2014-10-25T02:55:00.000Z"},{"amount":-219500,"is-pending":false,"aggregation-time":1414225140000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414284900000,"transaction-id":"1414284900000","raw-merchant":"BURGER KING","categorization":"Unknown","merchant":"Burger King","transaction-time":"2014-10-25T08:19:00.000Z"},{"amount":-103700,"is-pending":false,"aggregation-time":1414233780000,"account-id":"nonce:comfy-cc/hdhehe","clear-date":1414500660000,"transaction-id":"1414500660000","raw-merchant":"HUDSON NEWS","categorization":"Unknown","merchant":"...